{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://bestmuscat/schema/tools.schema.json",
  "title": "BestMuscat Place",
  "type": "array",
  "items": {
    "type": "object",
    "required": ["id", "slug", "name"],
    "additionalProperties": true,
    "properties": {
      "id": { "type": "string", "minLength": 1 },
      "slug": { "type": "string", "minLength": 1 },
      "name": { "type": "string", "minLength": 1 },

      "tagline": { "type": ["string", "null"] },
      "categories": { "type": "array", "items": { "type": "string" } },
      "tags": { "type": "array", "items": { "type": "string" } },
      "url": { "type": ["string", "null"] },

      "actions": {
        "type": "object",
        "additionalProperties": false,
        "properties": {
          "website":  { "type": ["string", "null"] },
          "phone":    { "type": ["string", "null"] },
          "maps_url": { "type": ["string", "null"] },
          "share":    { "type": ["string", "null", "boolean"] },
          "menu":     { "type": ["string", "null"] }     /* NEW (restaurants) */
        }
      },

      "location": {
        "type": "object",
        "additionalProperties": true,
        "properties": {
          "neighborhood": { "type": ["string", "null"] },
          "address":      { "type": ["string", "null"] },
          "city":         { "type": ["string", "null"] },
          "country":      { "type": ["string", "null"] },
          "lat":          { "type": ["number", "null"] },
          "lng":          { "type": ["number", "null"] }
        }
      },

      "images": {
        "type": "object",
        "additionalProperties": false,
        "properties": {
          "logo":       { "type": ["string", "null"] },
          "hero":       { "type": ["string", "null"] },
          "credit":     { "type": ["string", "null"] },
          "source_url": { "type": ["string", "null"] }
        }
      },

      "sources": {
        "type": "object",
        "additionalProperties": false,
        "properties": {
          "place_id":    { "type": ["string", "null"] },
          "wikidata_id": { "type": ["string", "null"] },
          "osm": {
            "type": "object",
            "additionalProperties": false,
            "properties": {
              "type": { "type": ["string", "null"], "enum": ["node", "way", "relation", null] },
              "id":   { "type": ["string", "number", "null"] }
            }
          }
        }
      },

      "hours": {
        "anyOf": [
          { "type": "null" },
          {
            "type": "object",
            "required": ["tz", "weekly"],
            "additionalProperties": false,
            "properties": {
              "tz": { "type": "string", "minLength": 1 },
              "weekly": {
                "type": "object",
                "additionalProperties": false,
                "properties": {
                  "mon": { "$ref": "#/$defs/dayArray" },
                  "tue": { "$ref": "#/$defs/dayArray" },
                  "wed": { "$ref": "#/$defs/dayArray" },
                  "thu": { "$ref": "#/$defs/dayArray" },
                  "fri": { "$ref": "#/$defs/dayArray" },
                  "sat": { "$ref": "#/$defs/dayArray" },
                  "sun": { "$ref": "#/$defs/dayArray" }
                }
              }
            }
          },
          {
            "type": "object",
            "additionalProperties": false,
            "properties": {
              "Mon": { "$ref": "#/$defs/legacyDayPair" },
              "Tue": { "$ref": "#/$defs/legacyDayPair" },
              "Wed": { "$ref": "#/$defs/legacyDayPair" },
              "Thu": { "$ref": "#/$defs/legacyDayPair" },
              "Fri": { "$ref": "#/$defs/legacyDayPair" },
              "Sat": { "$ref": "#/$defs/legacyDayPair" },
              "Sun": { "$ref": "#/$defs/legacyDayPair" }
            },
            "minProperties": 1
          },
          {
            "type": "array",
            "items": {
              "type": "object",
              "required": ["days", "open", "close"],
              "additionalProperties": true,
              "properties": {
                "days":  { "type": "string", "minLength": 1 },
                "open":  { "$ref": "#/$defs/time" },
                "close": { "$ref": "#/$defs/time" }
              }
            }
          }
        ]
      },

      /* ========== NEW OPTIONAL DETAIL FIELDS ========== */
      "price_range":   { "type": ["string", "null"] },     /* "$", "$$", "$$$" */
      "busyness_hint": { "type": ["string", "null"] },     /* "Usually Busy" */
      "rating_overall":{ "type": ["number", "null"] },     /* 0â€“10 */

      "subscores": {
        "type": ["object", "null"],
        "additionalProperties": false,
        "properties": {
          "Food Quality":             { "type": ["number", "null"] },
          "Service":                  { "type": ["number", "null"] },
          "Ambience":                 { "type": ["number", "null"] },
          "Value for Money":          { "type": ["number", "null"] },
          "Accessibility & Amenities":{ "type": ["number", "null"] }
        }
      },

      "public_reviews": {
        "type": ["object", "null"],
        "additionalProperties": false,
        "properties": {
          "source":       { "type": ["string", "null"] },   /* e.g., "Google" */
          "count":        { "type": ["integer", "null"] },  /* e.g., 119 */
          "insight":      { "type": ["string", "null"] },
          "last_updated": { "type": ["string", "null"], "pattern": "^\\d{4}-\\d{2}-\\d{2}$" }
        }
      },

      "about": {
        "type": ["object", "null"],
        "additionalProperties": false,
        "properties": {
          "short": { "type": ["string", "null"] },
          "long":  { "type": ["string", "null"] }
        }
      },

      "amenities": { "type": ["array", "null"], "items": { "type": "string" } },
      "cuisines":  { "type": ["array", "null"], "items": { "type": "string" } },
      "meals":     { "type": ["array", "null"], "items": { "type": "string" } }

      /* ========== /NEW OPTIONAL DETAIL FIELDS ========== */
    }
  },

  "$defs": {
    "time": {
      "type": "string",
      "pattern": "^(?:[01]\\d|2[0-3]):[0-5]\\d$"
    },
    "interval": {
      "type": "object",
      "additionalProperties": false,
      "required": ["open", "close"],
      "properties": {
        "open":  { "$ref": "#/$defs/time" },
        "close": { "$ref": "#/$defs/time" }
      }
    },
    "dayArray": {
      "type": "array",
      "items": { "$ref": "#/$defs/interval" }
    },
    "legacyDayPair": {
      "type": "array",
      "minItems": 2,
      "maxItems": 2,
      "items": { "$ref": "#/$defs/time" }
    }
  }
}
