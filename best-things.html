<!-- FILE: best-things.html -->
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Best Things to Do in Muscat – All Categories</title>
  <meta name="description" content="Discover the best things to do in Muscat across Tours & Experiences, Events and Venues, and Wellness & Aesthetics." />
  <link rel="icon" href="/favicon.ico" />
  <link rel="stylesheet" href="assets/styles.css?v=20251007" />

  <style>
    /* ===== PAGE-SCOPED STYLES (safe for this page only) ===== */
    body.bt-all #best-things .tabs { display: none; } /* we don't need tabs on see-all */

    /* wrapper */
    body.bt-all .wrap { max-width: var(--maxw); margin: 0 auto; }

    /* stacked sections */
    body.bt-all .bt-block { margin: 28px 0 44px; }

    /* section header */
    body.bt-all .bt-head {
      display: flex; align-items: baseline; justify-content: space-between; gap: 12px;
      margin-bottom: 14px; border-bottom: 1px solid var(--border); padding-bottom: 8px;
    }
    body.bt-all .bt-head h2 { margin: 0; font-size: 22px; }

    /* two-column layout: big left, minis right */
    body.bt-all .best-things-content {
      display: grid;
      grid-template-columns: 1.6fr 1fr;
      gap: 16px;
    }

    /* featured big card (left) */
    body.bt-all .featured-card .card-big,
    body.bt-all .featured-card > article {
      display: grid; grid-template-rows: auto 1fr;
      border: 1px solid var(--border); border-radius: 12px; overflow: hidden; background: #fff;
    }
    body.bt-all .featured-card img { width: 100%; height: 320px; object-fit: cover; display: block; }
    body.bt-all .featured-card .big-body { padding: 14px; display: grid; gap: 6px; }
    body.bt-all .featured-card .big-title { font-size: 20px; font-weight: 700; margin: 0; }
    body.bt-all .featured-card .big-meta { color: var(--muted); font-size: 14px; }
    body.bt-all .featured-card .big-score { font-size: 24px; font-weight: 800; margin-top: 6px; }

    /* mini list (right) */
    body.bt-all .top-listings { display: grid; gap: 12px; }
    body.bt-all .top-listings .mini-card {
      display: grid; grid-template-columns: 110px 1fr auto; gap: 10px; align-items: center;
      border: 1px solid var(--border); border-radius: 10px; padding: 8px; background: #fff;
    }
    body.bt-all .top-listings .mini-card img { width: 110px; height: 72px; object-fit: cover; border-radius: 8px; }
    body.bt-all .top-listings .mini-title { font-weight: 700; margin: 0; line-height: 1.2; }
    body.bt-all .top-listings .mini-meta { color: var(--muted); font-size: 13px; }
    body.bt-all .top-listings .mini-score { font-weight: 800; padding-left: 8px; }

    @media (max-width: 900px) {
      body.bt-all .best-things-content { grid-template-columns: 1fr; }
      body.bt-all .featured-card img { height: 220px; }
    }
  </style>
</head>

<body class="bt-all">
  <!-- Header -->
  <header class="site-header">
    <div class="header-wrap">
      <a href="index.html" class="header-logo" aria-label="BestMuscat home">
        <img src="assets/brand/bestmuscat-logo.png" alt="BestMuscat" />
      </a>
      <div class="header-actions">
        <a class="btn-suggest" href="index.html">← Back to Home</a>
      </div>
    </div>
  </header>

  <main>
    <div class="wrap">

      <!-- BEST THINGS TO DO IN MUSCAT (See-All) -->
      <section id="best-things" class="best-things">
        <div class="section-head">
          <h2>Best Things to Do in Muscat</h2>
          <p class="tagline">
            We use a weighted 10-point scoring system with carefully selected categories to evaluate the best places to visit and things to do in Muscat.
          </p>
        </div>

        <!-- Tabs markup kept for consistency (hidden via CSS above) -->
        <div class="tabs" aria-hidden="true">
          <button class="tab active" data-cat="tours" type="button">Tours & Experiences</button>
          <button class="tab" data-cat="events" type="button">Events and Venues</button>
          <button class="tab" data-cat="wellness" type="button">Wellness & Aesthetics</button>
          <a class="see-all" href="best-things.html?bt=all#best-things">See All&nbsp;→</a>
        </div>

        <!-- BLOCK 1: Tours & Experiences -->
        <section class="bt-block" id="bt-tours">
          <div class="bt-head"><h2>Tours & Experiences</h2></div>
          <div class="best-things-content">
            <div id="bt-tours-featured" class="featured-card" aria-label="Featured place"></div>
            <div id="bt-tours-list" class="top-listings" aria-label="Top listings"></div>
          </div>
        </section>

        <!-- BLOCK 2: Events and Venues -->
        <section class="bt-block" id="bt-events">
          <div class="bt-head"><h2>Events and Venues</h2></div>
          <div class="best-things-content">
            <div id="bt-events-featured" class="featured-card" aria-label="Featured place"></div>
            <div id="bt-events-list" class="top-listings" aria-label="Top listings"></div>
          </div>
        </section>

        <!-- BLOCK 3: Wellness & Aesthetics -->
        <section class="bt-block" id="bt-wellness">
          <div class="bt-head"><h2>Wellness & Aesthetics</h2></div>
          <div class="best-things-content">
            <div id="bt-wellness-featured" class="featured-card" aria-label="Featured place"></div>
            <div id="bt-wellness-list" class="top-listings" aria-label="Top listings"></div>
          </div>
        </section>

      </section>

    </div>
  </main>

  <footer>
    <div class="wrap">
      <small class="disclaimer">
        <strong>Places & Links Disclaimer.</strong> The places and external links referenced on this website are provided solely for informational purposes. Inclusion does not constitute endorsement or preference; no affiliate relationships. Features, pricing, availability and policies may change—verify current details before you visit.
      </small>
    </div>
  </footer>

  <!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/fuse.js@6.6.2"></script>
  <script src="assets/app.js?v=20251005"></script>
  <!-- (Removed assets/best-things.js on this page to avoid double render) -->
  <script id="jsonld-list" type="application/ld+json"></script>

  <!-- Force ?bt=all on this page so the JS renders all blocks at once -->
  <script>
    (function () {
      var url = new URL(location.href);
      if (url.searchParams.get('bt') !== 'all') {
        url.searchParams.set('bt','all');
        location.replace(url.toString());
      }
    })();
  </script>

  <!-- Inline renderer: populates featured + mini lists for all three sections -->
  <script>
  (function(){
    // Load data: use window.TOOLS if already injected; otherwise fetch the JSON
    async function getData(){
      if (window.TOOLS && Array.isArray(window.TOOLS)) return window.TOOLS;
      const res = await fetch('data/tools.json', { cache: 'no-store' });
      return res.json();
    }

    // Category matcher:
    // Your buttons use keys 'tours', 'events', 'wellness'.
    // We also accept 'explore' as an alias for wellness if your data uses it.
    function matchCategory(item, key){
      const slug = (item.category_slug || '').toLowerCase();
      const cat  = (item.category || '').toLowerCase();
      const tags = (item.tags || '').toLowerCase();

      if (slug === key) return true;
      if (key === 'wellness' && (slug === 'explore')) return true;

      if (key === 'tours'   && (cat.includes('tour') || tags.includes('tour'))) return true;
      if (key === 'events'  && (cat.includes('event') || tags.includes('event'))) return true;
      if (key === 'wellness' &&
          (cat.includes('wellness') || cat.includes('aesthetic') ||
           tags.includes('wellness') || tags.includes('spa') || tags.includes('aesthetic'))) return true;

      return false;
    }

    function byScoreThenName(a,b){
      const sa = Number(a.rating_overall || a.score || 0);
      const sb = Number(b.rating_overall || b.score || 0);
      if (sb !== sa) return sb - sa;
      return (a.name || '').localeCompare(b.name || '');
    }

    const imgSafe = (u,f)=> (u && u.trim()) || f || 'assets/placeholder-hero.jpg';
    const meta = it => {
      const city = it.city || 'Muscat';
      const area = it.neighborhood || it.district || '';
      return [city, area].filter(Boolean).join(' · ');
    };
    const score = it => (it.rating_overall ?? it.score ?? '').toString();

    const bigCard = it => `
      <article class="card-big">
        <a href="tool.html?slug=${encodeURIComponent(it.slug)}">
          <img alt="" src="${imgSafe(it.hero_url || it.image || it.banner)}">
        </a>
        <div class="big-body">
          <h3 class="big-title"><a href="tool.html?slug=${encodeURIComponent(it.slug)}">${it.name}</a></h3>
          <div class="big-meta">${meta(it)}${it.open_now ? ' · <span>Open</span>' : ''}</div>
          <div class="big-score">${score(it)}<span style="font-size:12px;">/10</span></div>
        </div>
      </article>`;

    const miniCard = it => `
      <a class="mini-card" href="tool.html?slug=${encodeURIComponent(it.slug)}">
        <img alt="" src="${imgSafe(it.hero_url || it.image || it.banner)}">
        <div>
          <p class="mini-title">${it.name}</p>
          <div class="mini-meta">${meta(it)}${it.open_now ? ' · Open' : ''}</div>
        </div>
        <div class="mini-score">${score(it)}</div>
      </a>`;

    function renderCategory(key, bigId, miniId, takeMini = 8){
      return items => {
        const list = items.filter(it => matchCategory(it, key)).sort(byScoreThenName);
        const big  = list[0];
        const rest = list.slice(1, 1 + takeMini);

        const bigEl  = document.getElementById(bigId);
        const miniEl = document.getElementById(miniId);

        if (bigEl && big) bigEl.innerHTML = bigCard(big);
        if (miniEl) miniEl.innerHTML = rest.map(miniCard).join('');
      };
    }

    // Render all three stacks at once (matching your element IDs)
    getData().then(data => {
      renderCategory('tours',    'bt-tours-featured',   'bt-tours-list')(data);
      renderCategory('events',   'bt-events-featured',  'bt-events-list')(data);
      renderCategory('wellness', 'bt-wellness-featured','bt-wellness-list')(data);
    }).catch(err => console.error('bt-all render error:', err));
  })();
  </script>
</body>
</html>
