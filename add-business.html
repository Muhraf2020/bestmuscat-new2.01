<!-- FILE: add-business.html -->
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Add My Business – Best Muscat</title>
  <meta name="description" content="Submit a business to Best Muscat for review and approval." />
  <link rel="icon" href="/favicon.ico" />
  <link rel="stylesheet" href="assets/styles.css?v=20251005" />
</head>
<body class="page-add-business">
  <!-- Header (same as other pages) -->
  <header class="site-header">
    <div class="header-wrap">
      <a href="index.html" class="header-logo" aria-label="BestMuscat home">
        <img src="assets/brand/bestmuscat-logo.png" alt="BestMuscat" />
      </a>
      <div class="header-search" role="search" aria-hidden="true" style="visibility:hidden;max-width:0;width:0;"></div>
      <div class="header-actions">
        <a class="btn-suggest" href="index.html">← Back to Directory</a>
      </div>
    </div>
  </header>

  <main>
    <div class="wrap">
      <section class="apply-card">
        <div class="apply-head">
          <div class="apply-status">
            <span class="dot dot-blue"></span> Apply
          </div>
          <div class="apply-badge">
            <img src="assets/brand/badge.png" alt="" aria-hidden="true" />
          </div>
          <div class="apply-mode">
            <span class="dot dot-green"></span> Instant
          </div>
        </div>

        <h1 class="apply-title">Add My Business</h1>
        <p class="apply-sub">Complete the form to submit your business for approval.</p>

        <!-- === Custom HTML form (keeps your exact layout/styles) === -->
        <form id="addBusinessForm" class="form" novalidate>
          <!-- Type of Place (chips -> radios) -->
          <fieldset class="form-fieldset">
            <legend class="form-label">Type of Place</legend>
            <div class="chip-group" role="group" aria-label="Type of Place">
              <label class="chip chip-toggle"><input type="radio" name="type" value="Restaurant" required /> Restaurant</label>
              <label class="chip chip-toggle"><input type="radio" name="type" value="Attraction" /> Attraction</label>
              <label class="chip chip-toggle"><input type="radio" name="type" value="Sports & Fitness" /> Sports-Fitness</label>
              <label class="chip chip-toggle"><input type="radio" name="type" value="School" /> School</label>
              <label class="chip chip-toggle"><input type="radio" name="type" value="Hotel" /> Hotel</label>
              <label class="chip chip-toggle"><input type="radio" name="type" value="Mall" /> Mall</label>
            </div>
            <p class="form-hint">Pick the closest match.</p>
          </fieldset>

          <!-- Basic details -->
          <div class="form-row">
            <label class="form-label" for="placeName">Place Name</label>
            <input class="form-input" id="placeName" name="place_name" type="text" required placeholder="Burj Khalifa" />
          </div>

          <div class="form-row">
            <label class="form-label" for="legalName">Legal Business Name</label>
            <input class="form-input" id="legalName" name="legal_name" type="text" placeholder="Emaar Properties PJSC" />
          </div>

          <!-- Your Role (chips -> radios) -->
          <fieldset class="form-fieldset">
            <legend class="form-label">Your Role</legend>
            <div class="chip-group" role="group" aria-label="Your Role">
              <label class="chip chip-toggle"><input type="radio" name="role" value="Owner" required /> Owner</label>
              <label class="chip chip-toggle"><input type="radio" name="role" value="Employee" /> Employee</label>
              <label class="chip chip-toggle"><input type="radio" name="role" value="Agency" /> Agency</label>
            </div>
          </fieldset>

          <!-- Contact -->
          <div class="grid-2">
            <div class="form-row">
              <label class="form-label" for="firstName">First Name</label>
              <input class="form-input" id="firstName" name="first_name" type="text" required />
            </div>
            <div class="form-row">
              <label class="form-label" for="lastName">Last Name</label>
              <input class="form-input" id="lastName" name="last_name" type="text" required />
            </div>
          </div>

          <div class="grid-2">
            <div class="form-row">
              <label class="form-label" for="email">E-mail</label>
              <input class="form-input" id="email" name="email" type="email" required placeholder="you@domain.com" />
            </div>
            <div class="form-row">
              <label class="form-label" for="phone">Phone</label>
              <input class="form-input" id="phone" name="phone" type="tel" inputmode="tel" placeholder="05XXXXXXXX" />
            </div>
          </div>

          <!-- Address / optional -->
          <div class="form-row">
            <label class="form-label" for="address">Address (optional)</label>
            <input class="form-input" id="address" name="address" type="text" placeholder="Street, Area, City" />
          </div>

          <!-- Website / GMaps -->
          <div class="grid-2">
            <div class="form-row">
              <label class="form-label" for="website">Website (optional)</label>
              <input class="form-input" id="website" name="website" type="url" placeholder="https://..." />
            </div>
            <div class="form-row">
              <label class="form-label" for="maps">Google Maps Link (optional)</label>
              <input class="form-input" id="maps" name="google_maps" type="url" placeholder="https://maps.google.com/..." />
            </div>
          </div>

          <!-- Optional: Notes -->
          <div class="form-row">
            <label class="form-label" for="notes">Notes (optional)</label>
            <textarea class="form-input" id="notes" name="notes" rows="4" placeholder="Anything we should know?"></textarea>
          </div>

          <!-- Authorization -->
          <div class="form-check">
            <input id="auth" type="checkbox" />
            <label for="auth">I have legal authorization to represent this business and provide verification documents if requested.</label>
          </div>

          <!-- Honeypot (spam trap) -->
          <input type="text" name="company" class="sr-only" tabindex="-1" autocomplete="off" aria-hidden="true" />

          <!-- Submit -->
          <button class="btn primary btn-submit" type="submit">Submit Application</button>
          <p id="formMsg" class="form-msg" role="status" aria-live="polite"></p>
        </form>

        <!-- Timeline (static) -->
        <div class="apply-steps">
          <div class="step">
            <div class="step-title">Verify Business <span class="muted">· 5 Days</span></div>
            <p>Once your application is approved, you will be contacted to verify your business and identification.</p>
          </div>
          <div class="step">
            <div class="step-title">Assessment & Scoring <span class="muted">· 10 Days</span></div>
            <p>Your business will be assessed, scored and listed. Our delegates may visit your establishment which will also impact scoring.</p>
          </div>
        </div>
      </section>
    </div>
  </main>

  <footer>
    <div class="wrap">
      <small class="disclaimer">By continuing, you agree to Best Muscat’s <a href="#">Terms of Use</a> and <a href="#">Privacy Policy</a>.</small>
    </div>
  </footer>

  <!-- === Same-page AJAX submit to Google Apps Script (Sheets) === -->
  <script>
  // Replace with your deployed Web App URL from Google Apps Script
  const ENDPOINT = 'https://script.google.com/macros/s/AKfycbyJoQ9UmDLiUovpMaIN7ZzQWEeNHZj1Qlz03vcWupqyDLcDMUIxX4sqFrSQRbMlw97E9A/exec'; // e.g., https://script.google.com/macros/s/AKfycbx.../exec

  (function () {
    const form = document.getElementById('addBusinessForm');
    const msg  = document.getElementById('formMsg');
    const btn  = document.querySelector('.btn-submit');

    if (!form) return;

    form.addEventListener('submit', async (e) => {
      e.preventDefault();

      // Basic front-end validation
      const requiredIds = ['placeName', 'firstName', 'lastName', 'email'];
      for (const id of requiredIds) {
        const el = document.getElementById(id);
        if (el && !el.value.trim()) {
          el.focus();
          msg.textContent = 'Please fill all required fields.';
          return;
        }
      }
      // Role: Owner/Employee/Agency (required group)
      if (!form.querySelector('input[name="role"]:checked')) {
        msg.textContent = 'Please select your role.'; return;
      }
      // Type of Place: required group
      if (!form.querySelector('input[name="type"]:checked')) {
        msg.textContent = 'Please select the type of place.'; return;
      }
      // Authorization required
      const auth = document.getElementById('auth');
      if (auth && !auth.checked) {
        msg.textContent = 'Please confirm authorization.'; auth.focus(); return;
      }
      // Honeypot (spam)
      if (form.company && form.company.value) return;

      // Collect data
      const fd = new FormData(form);
      const data = Object.fromEntries(fd.entries());
      data.authorization = auth && auth.checked ? 'yes' : 'no';
      data._ua = navigator.userAgent;

      // Lock UI
      if (btn) btn.disabled = true;
      msg.textContent = 'Submitting…';

      try {
        // Use no-cors so it works without custom CORS headers
        await fetch(ENDPOINT, {
          method: 'POST',
          mode: 'no-cors',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(data)
        });

        // Optimistic success (no-cors prevents reading JSON)
        form.reset();
        if (auth) auth.checked = false;
        msg.textContent = 'Thanks! Your submission has been received. We’ll review and get back to you.';
      } catch (err) {
        console.error(err);
        msg.textContent = 'Sorry, submission failed. Please try again in a moment.';
      } finally {
        if (btn) btn.disabled = false;
      }
    });
  })();
  </script>
</body>
</html>
